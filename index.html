<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thuisbatterij Calculator V9.4</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* CSS is ongewijzigd */
        body { font-family: 'Roboto', sans-serif; background-color: #f0f4f8; color: #333; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; box-sizing: border-box; }
        .container { max-width: 700px; width: 100%; background-color: #ffffff; padding: 40px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }
        .logo { max-width: 250px; width: 100%; height: auto; margin-bottom: 20px; }
        h1 { color: #1e3a5f; font-size: 2.5rem; margin-top: 0; }
        h2.question-title { font-size: 1.8rem; font-weight: 700; margin-bottom: 20px; color: #1e3a5f; }
        .step-container, #start-scherm { display: none; }
        .step-container.active, #start-scherm.active { display: block; }
        .answer-option { border: 2px solid #e0e6ed; border-radius: 12px; padding: 15px 20px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; text-align: left; }
        .answer-option:hover { border-color: #3498db; background-color: #f9fcff; }
        .answer-option.selected { border-color: #2ecc71; background-color: #eaf9ed; box-shadow: 0 4px 12px rgba(46, 204, 113, 0.2); }
        .answer-option .icon { font-size: 2rem; color: #1e3a5f; margin-right: 20px; display: flex; align-items: center; justify-content: center; width: 40px; flex-shrink: 0; }
        .input-text { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #e0e6ed; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        .button-container { display: flex; justify-content: space-between; margin-top: 30px; }
        .btn { padding: 15px 30px; border: none; border-radius: 50px; cursor: pointer; font-size: 1rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s ease; text-decoration: none; }
        .btn-primary { background-color: #3498db; color: white; }
        .btn-secondary { background-color: #e0e6ed; color: #555; }
        .progress-bar-container { background-color: #e0e6ed; border-radius: 50px; height: 10px; margin-bottom: 10px; }
        .progress-bar { height: 100%; background-color: #2ecc71; border-radius: 50px; width: 0%; transition: width 0.4s ease; }
        .progress-text { text-align: center; font-size: 0.9rem; margin-bottom: 20px; color: #555; }
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left; margin-top: 20px; }
        .result-card { background-color: #f9fbfd; padding: 20px; border-radius: 12px; border: 1px solid #e0e6ed; }
        .result-card h3 { display: flex; justify-content: space-between; align-items: center; margin-top: 0; color: #1e3a5f; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .result-card ul { padding-left: 0; margin: 0; list-style-type: none; }
        .result-card li { margin-bottom: 8px; color: #555; display: flex; justify-content: space-between; }
        .result-card .value { font-weight: 700; color: #333; }
        .main-recommendation { grid-column: 1 / -1; text-align: center; background-color: #eaf9ed; border-color: #2ecc71; }
        .chart-card { grid-column: 1 / -1; }
        .interactive-settings { grid-column: 1 / -1; }
        .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; }
        .setting-row label { font-weight: 500; margin-right: 10px; }
        .setting-row input[type="range"] { flex-grow: 1; margin: 0 15px; }
        .setting-row .value-display { font-weight: 700; min-width: 60px; text-align: right; }
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #2ecc71; }
        input:checked + .slider:before { transform: translateX(22px); }
        .chart-legend { text-align: center; margin-top: 15px; display: flex; flex-wrap: wrap; justify-content: center; }
        .legend-item { display: inline-flex; align-items: center; margin: 5px 10px; font-size: 0.9em; }
        .color-box { width: 15px; height: 15px; border-radius: 3px; margin-right: 5px; border: 1px solid rgba(0,0,0,0.1); }
        .verbruik-color { border: 2px solid rgba(231, 76, 60, 1); }
        .opbrengst-color { border: 2px solid rgba(46, 204, 113, 1); }
        .zonder-batt-color { background-color: rgba(155, 89, 182, 0.7); }
        .met-batt-color { background-color: rgba(52, 152, 219, 0.7); }
        #monthSelector { font-size: 0.9em; border-radius: 5px; border: 1px solid #ccc; padding: 4px 8px; }
        .version-display { font-size: 0.8em; color: #aaa; margin-top: 20px; text-align: center; }
        .chart-canvas-container { position: relative; height: 400px; width: 100%; }
        #adviesSamenvatting { line-height: 1.6; text-align: left; }
    </style>
</head>
<body>
    <div id="start-scherm" class="container active"> <img src="exclupower-logo.jpg" alt="Exclupower Bedrijfslogo" class="logo"> <h1>Welkom bij de Thuisbatterij Calculator</h1> <p>Ontdek welke thuisbatterij het beste bij uw situatie past.</p> <a href="#" class="btn btn-primary" id="startBtn">Start de berekening</a> <div class="version-display">Versie 9.4</div> </div>
    <div id="calculator-scherm" class="container" style="display: none;">
        <div id="step-1" class="step-container"> <h2 class="question-title">Wat is je geschatte jaarlijkse energieverbruik?</h2> <div class="answer-option" data-value="2000" onclick="selectAnswer(1, this)"><span class="icon">🏠</span>Tot 2.000 kWh</div> <div class="answer-option" data-value="3000" onclick="selectAnswer(1, this)"><span class="icon">👨‍👩‍👧</span>2.000 - 4.000 kWh</div> <div class="answer-option" data-value="5000" onclick="selectAnswer(1, this)"><span class="icon">👨‍👩‍👧‍👦</span>4.000 - 6.000 kWh</div> <div class="answer-option" data-value="7000" onclick="selectAnswer(1, this)"><span class="icon">🏘️</span>6.000 - 8.000 kWh</div> <div class="answer-option" data-value="9000" onclick="selectAnswer(1, this)"><span class="icon">🏰</span>8.000+ kWh</div> </div>
        <div id="step-2" class="step-container"> <h2 class="question-title">Heeft u al zonnepanelen?</h2> <div class="answer-option" data-value="ja" onclick="selectAnswer(2, this)"><span class="icon">☀️</span>Ja</div> <div class="answer-option" data-value="nee" onclick="selectAnswer(2, this)"><span class="icon">🚫</span>Nee</div> </div>
        <div id="step-3" class="step-container"> <h2 class="question-title">Heeft u interesse om zonnepanelen te laten installeren?</h2> <div class="answer-option" data-value="ja" onclick="selectAnswer(3, this)"><span class="icon">👍</span>Ja, ik heb interesse</div> <div class="answer-option" data-value="nee" onclick="selectAnswer(3, this)"><span class="icon">👎</span>Nee, op dit moment niet</div> <p class="reassurance-text">😉 Geen zorgen, met onze oplossingen lever je niks terug als je dat niet wilt.</p> </div>
        <div id="step-4" class="step-container"> <h2 class="question-title">Hoeveel zonnepanelen heeft u?</h2> <input type="number" id="panelenInput" class="input-text" placeholder="Voer het aantal zonnepanelen in" min="1"> <div class="answer-option" onclick="selectAnswer(4, this)" data-value="dummy"> <span class="icon">#️⃣</span>Klik op 'Volgende' als u het aantal heeft ingevuld. </div> </div>
        <div id="step-5" class="step-container"> <h2 class="question-title">Heeft u een elektrische auto?</h2> <div class="answer-option" data-value="ja" onclick="selectAnswer(5, this)"><span class="icon">🚗</span>Ja</div> <div class="answer-option" data-value="nee" onclick="selectAnswer(5, this)"><span class="icon">🚶</span>Nee</div> </div>
        <div id="step-6" class="step-container"> <h2 class="question-title">Heeft u een warmtepomp?</h2> <div class="answer-option" data-value="ja" onclick="selectAnswer(6, this)"><span class="icon">🔥</span>Ja</div> <div class="answer-option" data-value="nee" onclick="selectAnswer(6, this)"><span class="icon">❄️</span>Nee</div> </div>
        <div id="step-7" class="step-container"> <h2 class="question-title">Wil je een schaalbare batterij?</h2> <div class="answer-option" data-value="zeer-belangrijk" onclick="selectAnswer(7, this)"><span class="icon">📈</span>Zeer belangrijk</div> <div class="answer-option" data-value="belangrijk" onclick="selectAnswer(7, this)"><span class="icon">📊</span>Belangrijk</div> <div class="answer-option" data-value="niet-zo-belangrijk" onclick="selectAnswer(7, this)"><span class="icon">➖</span>Niet zo belangrijk</div> <div class="answer-option" data-value="helemaal-niet-belangrijk" onclick="selectAnswer(7, this)"><span class="icon">🚫</span>Helemaal niet belangrijk</div> </div>
        <div id="step-8" class="step-container"> <h2 class="question-title">Hoe belangrijk is smart home integratie?</h2> <div class="answer-option" data-value="zeer-belangrijk" onclick="selectAnswer(8, this)"><span class="icon">💡</span>Zeer belangrijk</div> <div class="answer-option" data-value="belangrijk" onclick="selectAnswer(8, this)"><span class="icon">📱</span>Belangrijk</div> <div class="answer-option" data-value="niet-zo-belangrijk" onclick="selectAnswer(8, this)"><span class="icon">🏠</span>Niet zo belangrijk</div> <div class="answer-option" data-value="helemaal-niet-belangrijk" onclick="selectAnswer(8, this)"><span class="icon">❌</span>Helemaal niet belangrijk</div> </div>
        <div id="step-9" class="step-container"> <h2 class="question-title">Interesse in dynamische energieprijzen?</h2> <div class="answer-option" data-value="zeer-geinteresseerd" onclick="selectAnswer(9, this)"><span class="icon">💰</span>Ja, zeer geïnteresseerd</div> <div class="answer-option" data-value="enigszins-geinteresseerd" onclick="selectAnswer(9, this)"><span class="icon">📈</span>Ja, enigszins</div> <div class="answer-option" data-value="niet-geinteresseerd" onclick="selectAnswer(9, this)"><span class="icon">💸</span>Nee, niet geïnteresseerd</div> </div>
        <div id="resultaat-stap" class="step-container">
            <h2 class="question-title">Uw Persoonlijke Advies Dashboard</h2>
            <div class="results-grid">
                <div class="result-card main-recommendation"> <h2>Uw Aanbevolen Batterijcapaciteit</h2> <p><strong id="capaciteitResultaat" style="font-size: 1.5em;"></strong></p> <div id="productAanbevelingDiv" style="display:none;"> <p id="productAdviesText"></p> <a href="#" id="productLink" class="btn btn-primary" target="_blank">Bekijk Product</a> </div> </div>
                <div class="result-card interactive-settings">
                    <h3>Verfijn uw advies</h3>
                    <div class="setting-row"> <label for="verbruikSlider">Jaarlijks verbruik</label> <input type="range" id="verbruikSlider" min="1000" max="15000" step="100"> <span class="value-display" id="verbruikValue">3000 kWh</span> </div>
                    <div class="setting-row"> <label for="panelenSlider">Aantal zonnepanelen</label> <input type="range" id="panelenSlider" min="0" max="40" step="1"> <span class="value-display" id="panelenValue">10</span> </div>
                    <div class="setting-row"> <label for="evToggle">Heeft/wil e-auto?</label> <label class="switch"> <input type="checkbox" id="evToggle"> <span class="slider"></span> </label> </div>
                    <div class="setting-row"> <label for="wpToggle">Heeft/wil warmtepomp?</label> <label class="switch"> <input type="checkbox" id="wpToggle"> <span class="slider"></span> </label> </div>
                </div>
                <div class="result-card" style="grid-column: 1 / -1;"> <h3>Samenvatting van uw Advies</h3> <p id="adviesSamenvatting"></p> </div>
                <div class="result-card"> <h3>Uw Situatie</h3> <ul id="huidigeSituatieLijst"></ul> </div>
                <div class="result-card"> <h3>Onze Aannames</h3> <ul id="aannamesLijst"></ul> </div>
                <div class="chart-card" id="vergelijkingsGrafiekDiv"> <h3>Jaarlijkse Kosten (Schatting)</h3> <div class="chart-canvas-container"><canvas id="vergelijkingChartCanvas"></canvas></div> </div>
                <div class="chart-card" id="priceChartDiv"> <h3>Dynamische Uurprijzen (Simulatie)</h3> <div class="chart-canvas-container"><canvas id="priceChartCanvas"></canvas></div> </div>
                <div class="chart-card" id="energieProfielDiv">
                    <h3>Energieprofiel (24u): Met en Zonder Batterij
                        <select id="monthSelector"></select>
                    </h3>
                    <div class="chart-canvas-container"><canvas id="dailyEnergyChartCanvas"></canvas></div>
                    <div class="chart-legend"> <span class="legend-item"><span class="color-box verbruik-color"></span>Verbruik</span> <span class="legend-item"><span class="color-box opbrengst-color"></span>Zon-opbrengst</span> <span class="legend-item"><span class="color-box zonder-batt-color"></span>Grid (Zonder Batterij)</span> <span class="legend-item"><span class="color-box met-batt-color"></span>Grid (Mét Batterij)</span> </div>
                </div>
            </div>
        </div>
        <div class="button-container"> <button class="btn btn-secondary" id="terugBtn" onclick="prevStep()">← Terug</button> <button class="btn btn-primary" id="volgendeBtn" onclick="nextStep()">Volgende →</button> </div>
        <div class="version-display">Versie 9.4</div>
    </div>

    <script>
        let currentStep = 1; const totalSteps = 9; const formAnswers = {};
        
        // --- PAS DEZE LINKS AAN NAAR UW EIGEN WEBSHOP ---
        const products = [
            { naam: "Instap Batterij 2.5 kWh", capaciteit: 2.5, link: "#" },
            // --- HIER IS UW TESTLINK TOEGEVOEGD ---
            { naam: "Basis Batterij 5 kWh", capaciteit: 5, link: "https://exclupower.nl/product/marstek-venus-2-0-5kw-plug-&-play-thuisbatterij" },
            { naam: "Standaard Batterij 7.5 kWh", capaciteit: 7.5, link: "#" },
            { naam: "Standaard Batterij 10 kWh", capaciteit: 10, link: "#" },
            { naam: "Premium Batterij 12.5 kWh", capaciteit: 12.5, link: "#" },
            { naam: "Premium Batterij 15 kWh", capaciteit: 15, link: "#" },
            { naam: "Grootverbruiker Batterij 20 kWh", capaciteit: 20, link: "#" }
        ];
        // ----------------------------------------------------

        const monthFactors = { "Jan": 0.3, "Feb": 0.5, "Mrt": 0.8, "Apr": 1.2, "Mei": 1.5, "Jun": 1.6, "Jul": 1.5, "Aug": 1.3, "Sep": 1.0, "Okt": 0.6, "Nov": 0.4, "Dec": 0.2 };
        const mockDayAheadPrices = [0.05,0.04,0.03,0.03,0.04,0.07,0.12,0.14,0.13,0.11,0.08,0.06,0.02,0.01,0.02,0.05,0.10,0.15,0.16,0.13,0.11,0.09,0.08,0.06];
        let dailyEnergyChart, vergelijkingChart, priceChart;
        
        document.addEventListener('DOMContentLoaded', () => { document.getElementById('startBtn').addEventListener('click', (e) => { e.preventDefault(); document.getElementById('start-scherm').style.display = 'none'; document.getElementById('calculator-scherm').style.display = 'block'; showStep(1); }); });
        function showStep(step) { document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active')); const el = document.getElementById(`step-${step}`) || document.getElementById('resultaat-stap'); if (el) el.classList.add('active'); updateButtons(); updateProgressBar(); }
        function updateButtons() { const t = document.getElementById('terugBtn'), v = document.getElementById('volgendeBtn'); t.style.display = (currentStep > 1 && currentStep <= totalSteps + 1) ? 'block' : 'none'; v.style.display = (currentStep <= totalSteps) ? 'block' : 'none'; let l = false; let ts = currentStep; while (ts < totalSteps) { ts++; if (!isStepSkipped(ts)) { l = false; break; } l = true; } v.textContent = (currentStep >= totalSteps || l) ? 'Bereken advies' : 'Volgende →'; }
        function updateProgressBar() { const p = ((currentStep - 1) / totalSteps) * 100; document.getElementById('progressBar').style.width = `${p}%`; document.getElementById('progressText').textContent = `${Math.round(p)}% Voltooid`; }
        function isStepSkipped(step) { if (step === 3 && formAnswers['step-2'] === 'ja') return true; if (step === 4 && formAnswers['step-2'] === 'nee') return true; return false; }
        function nextStep() { const cs = document.getElementById(`step-${currentStep}`); const so = cs.querySelector('.selected'); if (currentStep === 4) { const pi = document.getElementById('panelenInput'); if (!pi.value || parseInt(pi.value) <= 0) { alert("Vul een geldig aantal zonnepanelen in."); return; } formAnswers[`step-${currentStep}`] = parseInt(pi.value); cs.querySelector('.answer-option').classList.add('selected'); } else { if (!so) { alert("Selecteer een optie."); return; } formAnswers[`step-${currentStep}`] = so.dataset.value; } let l = false; let ts = currentStep; while (ts < totalSteps) { ts++; if (!isStepSkipped(ts)) { l = false; break; } l = true; } if (currentStep >= totalSteps || l) { berekenAdvies(); return; } do { currentStep++; } while (isStepSkipped(currentStep)); showStep(currentStep); }
        function prevStep() { delete formAnswers[`step-${currentStep}`]; do { currentStep--; } while (isStepSkipped(currentStep)); if (currentStep >= 1) showStep(currentStep); }
        function selectAnswer(step, element) { const c = document.getElementById(`step-${step}`); c.querySelectorAll('.answer-option').forEach(el => el.classList.remove('selected')); element.classList.add('selected'); }
        function findBestProduct(c) { let bp = null, md = Infinity; for (const p of products) { if (p.capaciteit >= c) { const d = p.capaciteit - c; if (d < md) { md = d; bp = p; } } } if (!bp) bp = products[products.length - 1]; return bp; }
        
        function berekenAdvies() { currentStep = totalSteps + 1; setupInteractiveControls(); showStep('resultaat-stap'); }
        function setupInteractiveControls() {
            const controls = ['verbruikSlider', 'panelenSlider', 'evToggle', 'wpToggle', 'monthSelector'];
            controls.forEach(id => { const el = document.getElementById(id); const eventType = el.type === 'range' ? 'input' : 'change'; el.addEventListener(eventType, recalculateAndRedraw); });
            document.getElementById('verbruikSlider').value = formAnswers['step-1'];
            document.getElementById('panelenSlider').value = (formAnswers['step-2'] === 'ja') ? formAnswers['step-4'] : (formAnswers['step-3'] === 'ja' ? 12 : 0);
            document.getElementById('evToggle').checked = formAnswers['step-5'] === 'ja';
            document.getElementById('wpToggle').checked = formAnswers['step-6'] === 'ja';
            const monthSelector = document.getElementById('monthSelector');
            monthSelector.innerHTML = '';
            Object.keys(monthFactors).forEach(month => monthSelector.add(new Option(month, monthFactors[month])));
            monthSelector.value = monthFactors["Jul"];
            recalculateAndRedraw();
        }
        
        function recalculateAndRedraw() {
            const state = { jaarlijksVerbruikKwh: parseInt(document.getElementById('verbruikSlider').value), aantalPanelen: parseInt(document.getElementById('panelenSlider').value), heeftEV: document.getElementById('evToggle').checked, heeftWarmtepomp: document.getElementById('wpToggle').checked, selectedMonthFactor: parseFloat(document.getElementById('monthSelector').value), interesseDynamisch: formAnswers['step-9'] || 'niet-geinteresseerd' };
            const calculations = calculateAdvice(state);
            updateDashboardUI(state, calculations);
        }

        function calculateAdvice(state) {
            let effectiefJaarlijksVerbruik = state.jaarlijksVerbruikKwh;
            if (state.heeftEV) effectiefJaarlijksVerbruik += (10 * 365);
            if (state.heeftWarmtepomp) effectiefJaarlijksVerbruik += (8 * 365);
            const verbruikBuitenZonuren = effectiefJaarlijksVerbruik * 0.6 / 365;
            let totaalWp = 0;
            if (state.aantalPanelen > 0) { const paneelType = (formAnswers['step-2'] === 'ja') ? 400 : 430; totaalWp = state.aantalPanelen * paneelType; }
            const jaarlijkseOpbrengstKwh = totaalWp * 0.9;
            const dagelijkseGemOpbrengstKwh = jaarlijkseOpbrengstKwh / 365;
            let basisAdvies;
            if (state.aantalPanelen === 0 && (state.interesseDynamisch === 'zeer-geinteresseerd' || state.interesseDynamisch === 'enigszins-geinteresseerd')) { basisAdvies = 5.0; } else { basisAdvies = Math.min(dagelijkseGemOpbrengstKwh, verbruikBuitenZonuren); }
            let handelsBonus = 0;
            if (state.aantalPanelen > 0) { if (state.interesseDynamisch === 'zeer-geinteresseerd') handelsBonus = 5.0; else if (state.interesseDynamisch === 'enigszins-geinteresseerd') handelsBonus = 2.5; }
            const totaalAdvies = basisAdvies + handelsBonus;
            const afgerondeCapaciteit = Math.ceil(totaalAdvies / 2.5) * 2.5;
            const batterijCapaciteit = Math.max(2.5, afgerondeCapaciteit);
            return { batterijCapaciteit, totaalWp, jaarlijkseOpbrengstKwh, dagelijkseGemOpbrengstKwh, basisAdvies, handelsBonus, totaalAdvies, totaalDagelijksVerbruik: effectiefJaarlijksVerbruik / 365 };
        }

        function updateDashboardUI(state, calcs) {
            document.getElementById('verbruikValue').textContent = `${state.jaarlijksVerbruikKwh} kWh`;
            document.getElementById('panelenValue').textContent = `${state.aantalPanelen}`;
            document.getElementById('capaciteitResultaat').textContent = `${calcs.batterijCapaciteit.toFixed(1)} kWh`;
            const aanbevolenProduct = findBestProduct(calcs.batterijCapaciteit);
            if (aanbevolenProduct) {
                let adviesText = `Om aan uw berekende behoefte van <strong>${calcs.batterijCapaciteit.toFixed(1)} kWh</strong> te voldoen, adviseren wij het dichtstbijzijnde, grotere model: de <strong>${aanbevolenProduct.naam}</strong>.`;
                if (calcs.batterijCapaciteit == aanbevolenProduct.capaciteit) { adviesText = `Wij adviseren de <strong>${aanbevolenProduct.naam}</strong>.` }
                document.getElementById('productAdviesText').innerHTML = adviesText;
                document.getElementById('productLink').href = aanbevolenProduct.link;
                document.getElementById('productAanbevelingDiv').style.display = 'block';
            }
            let samenvatting = `Op basis van een jaarlijks verbruik van <strong>${state.jaarlijksVerbruikKwh} kWh</strong> en <strong>${state.aantalPanelen} zonnepanelen</strong>, is uw basisbehoefte voor zelfconsumptie circa <strong>${calcs.basisAdvies.toFixed(1)} kWh</strong>. `;
            if (calcs.handelsBonus > 0) { samenvatting += `Daar is een handelsbonus van <strong>${calcs.handelsBonus.toFixed(1)} kWh</strong> aan toegevoegd vanwege uw interesse in dynamische prijzen. `; }
            samenvatting += `Dit leidt tot een totaal berekend advies van <strong>${calcs.totaalAdvies.toFixed(1)} kWh</strong>, wat we afronden naar het best passende model van <strong>${calcs.batterijCapaciteit.toFixed(1)} kWh</strong>.`
            document.getElementById('adviesSamenvatting').innerHTML = samenvatting;
            let aannamesHTML = `<li><span>Conversiefactor (jaar):</span> <span class="value">0,9 kWh/Wp</span></li>`;
            if (state.aantalPanelen > 0) { const paneelType = (formAnswers['step-2'] === 'ja') ? 400 : 430; aannamesHTML += `<li><span>Zonnepanelen:</span> <span class="value">${state.aantalPanelen} × ${paneelType} Wp</span></li>`; }
            document.getElementById('aannamesLijst').innerHTML = aannamesHTML;
            let situatieHTML = `<li><span>Jaarlijks verbruik:</span> <span class="value">${state.jaarlijksVerbruikKwh} kWh</span></li>`;
            situatieHTML += `<li><span>Zonnepanelen:</span> <span class="value">${state.aantalPanelen} stuks</span></li>`;
            situatieHTML += `<li><span>Grootverbruikers:</span> <span class="value">${(state.heeftEV || state.heeftWarmtepomp) ? `${state.heeftEV ? 'E-Auto' : ''} ${state.heeftWarmtepomp ? 'Warmtepomp' : ''}`.trim() : 'Geen'}</span></li>`;
            document.getElementById('huidigeSituatieLijst').innerHTML = situatieHTML;
            renderVergelijkingChart(state.jaarlijksVerbruikKwh, calcs.jaarlijkseOpbrengstKwh);
            renderPriceChart(mockDayAheadPrices);
            if (calcs.totaalWp > 0) { document.getElementById('energieProfielDiv').style.display = 'block'; renderDailyEnergyChart(calcs.totaalDagelijksVerbruik, calcs.dagelijkseGemOpbrengstKwh, calcs.batterijCapaciteit, state.selectedMonthFactor); } 
            else { document.getElementById('energieProfielDiv').style.display = 'none'; }
        }
        
        function renderVergelijkingChart(jaarlijksVerbruik, jaarlijkseOpbrengst) { const ctx = document.getElementById('vergelijkingChartCanvas').getContext('2d'); const stroomprijs = 0.30; const terugleververgoeding = 0.05; const zelfverbruikPercentage = 0.35; const kostenZonderPanelen = jaarlijksVerbruik * stroomprijs; const directEigenVerbruik = Math.min(jaarlijksVerbruik, jaarlijkseOpbrengst * zelfverbruikPercentage); const nogTeKopenStroom = jaarlijksVerbruik - directEigenVerbruik; const teruggeleverdeStroom = jaarlijkseOpbrengst - directEigenVerbruik; const kostenMetPanelen = Math.max(0, (nogTeKopenStroom * stroomprijs) - (teruggeleverdeStroom * terugleververgoeding)); if (vergelijkingChart) vergelijkingChart.destroy(); vergelijkingChart = new Chart(ctx, { type: 'bar', data: { labels: ['Zonder Zonnepanelen', 'Met Zonnepanelen'], datasets: [{ label: 'Geschatte Jaarlijkse Energiekosten', data: [kostenZonderPanelen.toFixed(0), kostenMetPanelen.toFixed(0)], backgroundColor: ['rgba(231, 76, 60, 0.7)', 'rgba(46, 204, 113, 0.7)'], }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (c) => `€ ${c.raw}` } } }, scales: { y: { beginAtZero: true, ticks: { callback: (v) => `€ ${v}` } } } } }); }
        function renderPriceChart(prices) { const ctx = document.getElementById('priceChartCanvas').getContext('2d'); if (priceChart) priceChart.destroy(); priceChart = new Chart(ctx, { type: 'bar', data: { labels: Array.from({length: 24}, (_, i) => `${i}:00`), datasets: [{ label: 'Kale Stroomprijs (€/kWh)', data: prices, backgroundColor: prices.map(p => p < 0.05 ? 'rgba(46, 204, 113, 0.7)' : 'rgba(243, 156, 18, 0.7)') }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (c) => `€ ${c.raw.toFixed(3)}` } } }, scales: { y: { beginAtZero: true, title: {display: true, text: 'Kale Prijs (€/kWh)'} } } } }); }
        function renderDailyEnergyChart(dagelijksVerbruik, dagelijkseGemOpbrengst, batterijCapaciteit, monthFactor) { const ctx = document.getElementById('dailyEnergyChartCanvas').getContext('2d'); const dagelijkseOpbrengstDezeMaand = dagelijkseGemOpbrengst * monthFactor; const verbruikProfiel = [0.03,0.02,0.02,0.02,0.03,0.05,0.07,0.06,0.05,0.04,0.04,0.04,0.05,0.04,0.04,0.05,0.06,0.08,0.09,0.08,0.07,0.06,0.05,0.04]; const zonneProfiel = [0,0,0,0,0,0.01,0.03,0.06,0.09,0.11,0.13,0.14,0.13,0.12,0.09,0.05,0.03,0.01,0,0,0,0,0,0]; const geschaaldVerbruik = verbruikProfiel.map(p => p * dagelijksVerbruik); const geschaaldeOpbrengst = zonneProfiel.map(p => p * dagelijkseOpbrengstDezeMaand); const nettoVanGridZonderBatterij = geschaaldeOpbrengst.map((opbrengst, i) => opbrengst - geschaaldVerbruik[i]); let batterijLading = 0; const nettoVanGridMetBatterij = []; for (let i = 0; i < 24; i++) { const netto = geschaaldeOpbrengst[i] - geschaaldVerbruik[i]; if (netto > 0) { const kanOpladen = batterijCapaciteit - batterijLading; const laadHoeveelheid = Math.min(netto, kanOpladen); batterijLading += laadHoeveelheid; nettoVanGridMetBatterij.push(-(netto - laadHoeveelheid)); } else { const kanOntladen = batterijLading; const ontlaadHoeveelheid = Math.min(-netto, kanOntladen); batterijLading -= ontlaadHoeveelheid; nettoVanGridMetBatterij.push(-netto - ontlaadHoeveelheid); } } if (dailyEnergyChart) dailyEnergyChart.destroy(); dailyEnergyChart = new Chart(ctx, { type: 'bar', data: { labels: Array.from({length: 24}, (_, i) => `${i}:00`), datasets: [ { type: 'line', label: 'Verbruik', data: geschaaldVerbruik, borderColor: 'rgba(231, 76, 60, 1)', tension: 0.4, order: 1, borderWidth: 2 }, { type: 'line', label: 'Zonne-opbrengst', data: geschaaldeOpbrengst, borderColor: 'rgba(46, 204, 113, 1)', tension: 0.4, order: 2, borderWidth: 2 }, { label: 'Grid (Zonder Batterij)', data: nettoVanGridZonderBatterij, backgroundColor: 'rgba(155, 89, 182, 0.7)', order: 3 }, { label: 'Grid (Mét Batterij)', data: nettoVanGridMetBatterij, backgroundColor: 'rgba(52, 152, 219, 0.7)', order: 4, barPercentage: 0.6 } ] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: false, title: { display: true, text: 'Tijdstip (uur)' } }, y: { stacked: false, title: { display: true, text: 'Energie (kWh)' } } }, plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false, callbacks: { label: (c) => `${c.dataset.label}: ${c.parsed.y.toFixed(2)} kWh` } } } } }); }
    </script>
</body>
</html>
