<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thuisbatterij Calculator V4.1</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f0f4f8; color: #333; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; box-sizing: border-box; }
        .container { max-width: 700px; width: 100%; background-color: #ffffff; padding: 40px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }
        .logo { max-width: 250px; width: 100%; height: auto; margin-bottom: 20px; }
        h1 { color: #1e3a5f; font-size: 2.5rem; margin-top: 0; }
        h2.question-title { font-size: 1.8rem; font-weight: 700; margin-bottom: 20px; color: #1e3a5f; }
        .step-container, #start-scherm { display: none; }
        .step-container.active, #start-scherm.active { display: block; }
        .answer-option { border: 2px solid #e0e6ed; border-radius: 12px; padding: 15px 20px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; text-align: left; }
        .answer-option:hover { border-color: #3498db; background-color: #f9fcff; }
        .answer-option.selected { border-color: #2ecc71; background-color: #eaf9ed; box-shadow: 0 4px 12px rgba(46, 204, 113, 0.2); }
        .answer-option .icon { font-size: 2rem; color: #1e3a5f; margin-right: 20px; display: flex; align-items: center; justify-content: center; width: 40px; flex-shrink: 0; }
        .input-text { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #e0e6ed; border-radius: 8px; box-sizing: border-box; font-size: 1rem; transition: border-color 0.3s; }
        .input-text:focus { outline: none; border-color: #3498db; }
        .button-container { display: flex; justify-content: space-between; margin-top: 30px; }
        .btn { padding: 15px 30px; border: none; border-radius: 50px; cursor: pointer; font-size: 1rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s ease; text-decoration: none; }
        .btn-primary { background-color: #3498db; color: white; }
        .btn-primary:hover { background-color: #2980b9; transform: translateY(-2px); }
        .btn-secondary { background-color: #e0e6ed; color: #555; }
        .btn-secondary:hover { background-color: #c9d0d8; transform: translateY(-2px); }
        .progress-bar-container { background-color: #e0e6ed; border-radius: 50px; height: 10px; margin-bottom: 10px; }
        .progress-bar { height: 100%; background-color: #2ecc71; border-radius: 50px; width: 0%; transition: width 0.4s ease; }
        .progress-text { text-align: center; font-size: 0.9rem; margin-bottom: 20px; color: #555; }
        .reassurance-text { font-style: italic; color: #555; margin-top: 20px; }
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left; margin-top: 20px; }
        .result-card { background-color: #f9fbfd; padding: 20px; border-radius: 12px; border: 1px solid #e0e6ed; }
        .result-card h3 { margin-top: 0; color: #1e3a5f; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .result-card ul { padding-left: 20px; margin: 0; }
        .result-card li { margin-bottom: 8px; color: #555; }
        .result-card .value { font-weight: 700; color: #333; }
        .main-recommendation { grid-column: 1 / -1; text-align: center; background-color: #eaf9ed; border-color: #2ecc71; }
        .main-recommendation h2 { font-size: 1.8rem; color: #27ae60; margin-top: 0; }
        .main-recommendation p { font-size: 1.2rem; }
        .chart-card { grid-column: 1 / -1; height: 350px; }
        .interactive-settings { grid-column: 1 / -1; }
        .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; }
        .setting-row label { font-weight: 500; margin-right: 10px; }
        .setting-row input[type="range"] { flex-grow: 1; margin: 0 15px; }
        .setting-row .value-display { font-weight: 700; min-width: 60px; text-align: right; }
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #2ecc71; }
        input:checked + .slider:before { transform: translateX(22px); }
    </style>
</head>
<body>
    <div id="start-scherm" class="container active"> <img src="exclupower-logo.jpg" alt="Exclupower Bedrijfslogo" class="logo"> <h1>Welkom bij de Thuisbatterij Calculator</h1> <p>Ontdek welke thuisbatterij het beste bij uw situatie past.</p> <a href="#" class="btn btn-primary" id="startBtn">Start de berekening</a> </div>
    <div id="calculator-scherm" class="container" style="display: none;">
        <div class="progress-bar-container"> <div class="progress-bar" id="progressBar"></div> </div> <div class="progress-text" id="progressText">0% Voltooid</div>
        <div id="step-1" class="step-container"> <h2 class="question-title">Wat is je geschatte jaarlijkse energieverbruik?</h2> <div class="answer-option" data-value="2000" onclick="selectAnswer(1, this)"><span class="icon">ğŸ </span>Tot 2.000 kWh</div> <div class="answer-option" data-value="3000" onclick="selectAnswer(1, this)"><span class="icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span>2.000 - 4.000 kWh</div> <div class="answer-option" data-value="5000" onclick="selectAnswer(1, this)"><span class="icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>4.000 - 6.000 kWh</div> <div class="answer-option" data-value="7000" onclick="selectAnswer(1, this)"><span class="icon">ğŸ˜ï¸</span>6.000 - 8.000 kWh</div> <div class="answer-option" data-value="9000" onclick="selectAnswer(1, this)"><span class="icon">ğŸ°</span>8.000+ kWh</div> </div>
        <div id="step-2" class="step-container"> <h2 class="question-title">Heeft u al zonnepanelen?</h2> <div class="answer-option" data-value="ja" onclick="selectAnswer(2, this)"><span class="icon">â˜€ï¸</span>Ja</div> <div class="answer-option" data-value="nee" onclick="selectAnswer(2, this)"><span class="icon">ğŸš«</span>Nee</div> </div>
        <div id="step-3" class="step-container"> <h2 class="question-title">Heeft u interesse om zonnepanelen te laten installeren?</h2> <div class="answer-option" data-value="ja" onclick="selectAnswer(3, this)"><span class="icon">ğŸ‘</span>Ja, ik heb interesse</div> <div class="answer-option" data-value="nee" onclick="selectAnswer(3, this)"><span class="icon">ğŸ‘</span>Nee, op dit moment niet</div> <p class="reassurance-text">ğŸ˜‰ Geen zorgen, met onze oplossingen lever je niks terug als je dat niet wilt.</p> </div>
        <div id="step-4" class="step-container"> <h2 class="question-title">Hoeveel zonnepanelen heeft u?</h2> <input type="number" id="panelenInput" class="input-text" placeholder="Voer het aantal zonnepanelen in" min="1"> <div class="answer-option" onclick="selectAnswer(4, this)" data-value="dummy"> <span class="icon">#ï¸âƒ£</span>Klik op 'Volgende' als u het aantal heeft ingevuld. </div> </div>
        <div id="step-5" class="step-container"> <h2 class="question-title">Heeft u een elektrische auto?</h2> <div class="answer-option" data-value="ja" onclick="selectAnswer(5, this)"><span class="icon">ğŸš—</span>Ja</div> <div class="answer-option" data-value="nee" onclick="selectAnswer(5, this)"><span class="icon">ğŸš¶</span>Nee</div> </div>
        <div id="step-6" class="step-container"> <h2 class="question-title">Heeft u een warmtepomp?</h2> <div class="answer-option" data-value="ja" onclick="selectAnswer(6, this)"><span class="icon">ğŸ”¥</span>Ja</div> <div class="answer-option" data-value="nee" onclick="selectAnswer(6, this)"><span class="icon">â„ï¸</span>Nee</div> </div>
        <div id="step-7" class="step-container"> <h2 class="question-title">Wil je een schaalbare batterij?</h2> <div class="answer-option" data-value="zeer-belangrijk" onclick="selectAnswer(7, this)"><span class="icon">ğŸ“ˆ</span>Zeer belangrijk</div> <div class="answer-option" data-value="belangrijk" onclick="selectAnswer(7, this)"><span class="icon">ğŸ“Š</span>Belangrijk</div> <div class="answer-option" data-value="niet-zo-belangrijk" onclick="selectAnswer(7, this)"><span class="icon">â–</span>Niet zo belangrijk</div> <div class="answer-option" data-value="helemaal-niet-belangrijk" onclick="selectAnswer(7, this)"><span class="icon">ğŸš«</span>Helemaal niet belangrijk</div> </div>
        <div id="step-8" class="step-container"> <h2 class="question-title">Hoe belangrijk is smart home integratie?</h2> <div class="answer-option" data-value="zeer-belangrijk" onclick="selectAnswer(8, this)"><span class="icon">ğŸ’¡</span>Zeer belangrijk</div> <div class="answer-option" data-value="belangrijk" onclick="selectAnswer(8, this)"><span class="icon">ğŸ“±</span>Belangrijk</div> <div class="answer-option" data-value="niet-zo-belangrijk" onclick="selectAnswer(8, this)"><span class="icon">ğŸ </span>Niet zo belangrijk</div> <div class="answer-option" data-value="helemaal-niet-belangrijk" onclick="selectAnswer(8, this)"><span class="icon">âŒ</span>Helemaal niet belangrijk</div> </div>
        <div id="step-9" class="step-container"> <h2 class="question-title">Interesse in dynamische energieprijzen?</h2> <div class="answer-option" data-value="zeer-geinteresseerd" onclick="selectAnswer(9, this)"><span class="icon">ğŸ’°</span>Ja, zeer geÃ¯nteresseerd</div> <div class="answer-option" data-value="enigszins-geinteresseerd" onclick="selectAnswer(9, this)"><span class="icon">ğŸ“ˆ</span>Ja, enigszins</div> <div class="answer-option" data-value="niet-geinteresseerd" onclick="selectAnswer(9, this)"><span class="icon">ğŸ’¸</span>Nee, niet geÃ¯nteresseerd</div> </div>
        <div id="resultaat-stap" class="step-container">
            <h2 class="question-title">Uw Persoonlijke Advies Dashboard</h2>
            <div class="results-grid">
                <div class="result-card main-recommendation"> <h2>Uw Aanbevolen Batterijcapaciteit</h2> <p><strong id="capaciteitResultaat" style="font-size: 1.5em;"></strong></p> <div id="productAanbevelingDiv" style="display:none;"> <p>Wij adviseren de <strong id="productNaam"></strong>.</p> <a href="#" id="productLink" class="btn btn-primary" target="_blank">Bekijk Product</a> </div> </div>
                <div class="result-card interactive-settings">
                    <h3>Verfijn uw advies</h3>
                    <div class="setting-row"> <label for="verbruikSlider">Jaarlijks verbruik</label> <input type="range" id="verbruikSlider" min="1000" max="15000" step="100"> <span class="value-display" id="verbruikValue">3000 kWh</span> </div>
                    <div class="setting-row"> <label for="panelenSlider">Aantal zonnepanelen</label> <input type="range" id="panelenSlider" min="0" max="40" step="1"> <span class="value-display" id="panelenValue">10</span> </div>
                    <div class="setting-row"> <label for="evToggle">Toekomstige e-auto?</label> <label class="switch"> <input type="checkbox" id="evToggle"> <span class="slider"></span> </label> </div>
                    <div class="setting-row"> <label for="wpToggle">Toekomstige warmtepomp?</label> <label class="switch"> <input type="checkbox" id="wpToggle"> <span class="slider"></span> </label> </div>
                </div>
                <div class="result-card"> <h3>Uw Huidige Situatie</h3> <ul id="huidigeSituatieLijst"></ul> </div>
                <div class="result-card"> <h3>Onze Aannames</h3> <ul id="aannamesLijst"></ul> </div>
                <div class="chart-card" id="vergelijkingsGrafiekDiv"> <h3>Besparingspotentieel met Zonnepanelen</h3> <canvas id="vergelijkingChartCanvas"></canvas> </div>
                <div class="chart-card" id="energieProfielDiv"> <h3>Gesimuleerd Energieprofiel (24 uur)</h3> <canvas id="dailyEnergyChartCanvas"></canvas> </div>
            </div>
        </div>
        <div class="button-container"> <button class="btn btn-secondary" id="terugBtn" onclick="prevStep()">â† Terug</button> <button class="btn btn-primary" id="volgendeBtn" onclick="nextStep()">Volgende â†’</button> </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 9;
        const formAnswers = {};
        const products = [ { naam: "Basis Batterij 5 kWh", capaciteit: 5, link: "#" }, { naam: "Standaard Batterij 8 kWh", capaciteit: 8, link: "#" }, { naam: "Standaard Batterij 10 kWh", capaciteit: 10, link: "#" }, { naam: "Premium Batterij 15 kWh", capaciteit: 15, link: "#" }, { naam: "Grootverbruiker Batterij 20 kWh", capaciteit: 20, link: "#" } ];
        let dailyEnergyChart, vergelijkingChart;

        // --- GECORRIGEERDE JAVASCRIPT ---

        document.getElementById('startBtn').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('start-scherm').style.display = 'none';
            document.getElementById('calculator-scherm').style.display = 'block';
            showStep(1);
        });

        function showStep(step) {
            document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
            const el = document.getElementById(`step-${step}`) || document.getElementById('resultaat-stap');
            if (el) el.classList.add('active');
            updateButtons();
            updateProgressBar();
        }

        function updateButtons() {
            const terugBtn = document.getElementById('terugBtn');
            const volgendeBtn = document.getElementById('volgendeBtn');
            terugBtn.style.display = (currentStep > 1 && currentStep <= totalSteps + 1) ? 'block' : 'none';
            volgendeBtn.style.display = (currentStep <= totalSteps) ? 'block' : 'none';
            
            let isLastStep = false;
            let tempStep = currentStep;
            while (tempStep < totalSteps) {
                tempStep++;
                if (!isStepSkipped(tempStep)) {
                    isLastStep = false;
                    break;
                }
                isLastStep = true;
            }
            volgendeBtn.textContent = (currentStep >= totalSteps || isLastStep) ? 'Bereken advies' : 'Volgende â†’';
        }

        function updateProgressBar() {
            const percentage = ((currentStep - 1) / totalSteps) * 100;
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `${Math.round(percentage)}% Voltooid`;
        }

        function isStepSkipped(step) {
            if (step === 3 && formAnswers['step-2'] === 'ja') return true;
            if (step === 4 && formAnswers['step-2'] === 'nee') return true;
            return false;
        }

        function nextStep() {
            const currentStepElement = document.getElementById(`step-${currentStep}`);
            const selectedOption = currentStepElement.querySelector('.selected');

            if (currentStep === 4) {
                const panelenInput = document.getElementById('panelenInput');
                if (!panelenInput.value || parseInt(panelenInput.value) <= 0) {
                    alert("Vul een geldig aantal zonnepanelen in.");
                    return;
                }
                formAnswers[`step-${currentStep}`] = parseInt(panelenInput.value);
                currentStepElement.querySelector('.answer-option').classList.add('selected');
            } else {
                if (!selectedOption) {
                    alert("Selecteer een optie.");
                    return;
                }
                // Bug fix: Alleen het antwoord van de HUIDIGE stap opslaan.
                formAnswers[`step-${currentStep}`] = selectedOption.dataset.value;
            }

            let isLastStep = false;
            let tempStep = currentStep;
            while (tempStep < totalSteps) {
                tempStep++;
                if (!isStepSkipped(tempStep)) {
                    isLastStep = false;
                    break;
                }
                isLastStep = true;
            }
            if (currentStep >= totalSteps || isLastStep) {
                berekenAdvies();
                return;
            }
            do {
                currentStep++;
            } while (isStepSkipped(currentStep));
            showStep(currentStep);
        }
        
        // De rest van de functies blijven ongewijzigd
        function prevStep() { delete formAnswers[`step-${currentStep}`]; do { currentStep--; } while (isStepSkipped(currentStep)); if (currentStep >= 1) showStep(currentStep); }
        function selectAnswer(step, element) { const c = document.getElementById(`step-${step}`); c.querySelectorAll('.answer-option').forEach(el => el.classList.remove('selected')); element.classList.add('selected'); }
        function findBestProduct(c) { let bp = null, md = Infinity; for(const p of products){ if(p.capaciteit>=c){const d=p.capaciteit-c; if(d<md){md=d;bp=p;}}} if(!bp) bp=products[products.length-1]; return bp; }
        function berekenAdvies() { currentStep = totalSteps + 1; setupInteractiveControls(); updateResults(); showStep('resultaat-stap'); updateProgressBar(); }
        function setupInteractiveControls() { const verbruikSlider = document.getElementById('verbruikSlider'); const panelenSlider = document.getElementById('panelenSlider'); const evToggle = document.getElementById('evToggle'); const wpToggle = document.getElementById('wpToggle'); verbruikSlider.value = formAnswers['step-1']; panelenSlider.value = (formAnswers['step-2'] === 'ja') ? formAnswers['step-4'] : (formAnswers['step-3'] === 'ja' ? 12 : 0); evToggle.checked = formAnswers['step-5'] === 'ja'; wpToggle.checked = formAnswers['step-6'] === 'ja'; updateSliderValue('verbruik'); updateSliderValue('panelen'); verbruikSlider.addEventListener('input', () => updateSliderValue('verbruik')); panelenSlider.addEventListener('input', () => updateSliderValue('panelen')); evToggle.addEventListener('change', updateResults); wpToggle.addEventListener('change', updateResults); }
        function updateSliderValue(type) { const slider = document.getElementById(`${type}Slider`); const display = document.getElementById(`${type}Value`); display.textContent = `${slider.value}${type === 'verbruik' ? ' kWh' : ''}`; updateResults(); }
        function updateResults() { const jaarlijksVerbruikKwh = parseInt(document.getElementById('verbruikSlider').value); const aantalPanelen = parseInt(document.getElementById('panelenSlider').value); const heeftEV = document.getElementById('evToggle').checked; const heeftWarmtepomp = document.getElementById('wpToggle').checked; let totaalWp = 0; let aannamesHTML = `<li>Conversiefactor: <span class="value">0,9 kWh / Wp</span></li>`; if (aantalPanelen > 0) { const paneelType = (formAnswers['step-2'] === 'ja') ? 400 : 430; totaalWp = aantalPanelen * paneelType; aannamesHTML += `<li>Zonnepanelen: <span class="value">${aantalPanelen} x ${paneelType} Wp</span></li>`; } const jaarlijkseOpbrengstKwh = totaalWp * 0.9; const dagelijkseOpbrengstKwh = jaarlijkseOpbrengstKwh / 365; const dagelijksBasisVerbruik = jaarlijksVerbruikKwh / 365; const totaalDagelijksVerbruik = dagelijksBasisVerbruik + (heeftEV ? 10 : 0) + (heeftWarmtepomp ? 8 : 0); let batterijCapaciteit = (dagelijkseOpbrengstKwh > dagelijksBasisVerbruik) ? (dagelijkseOpbrengstKwh - dagelijksBasisVerbruik) * 0.75 : 5; batterijCapaciteit = Math.max(5, Math.round(batterijCapaciteit)); document.getElementById('capaciteitResultaat').textContent = `${batterijCapaciteit} kWh`; document.getElementById('aannamesLijst').innerHTML = aannamesHTML; let situatieHTML = `<li>Jaarlijks verbruik: <span class="value">${jaarlijksVerbruikKwh} kWh</span></li>`; situatieHTML += `<li>Zonnepanelen: <span class="value">${aantalPanelen} stuks</span></li>`; situatieHTML += `<li>Grootverbruikers: <span class="value">${heeftEV ? 'E-Auto' : ''} ${heeftWarmtepomp ? 'Warmtepomp' : ''}` || 'Geen'; document.getElementById('huidigeSituatieLijst').innerHTML = situatieHTML; const aanbevolenProduct = findBestProduct(batterijCapaciteit); if (aanbevolenProduct) { document.getElementById('productNaam').textContent = aanbevolenProduct.naam; document.getElementById('productLink').href = aanbevolenProduct.link; document.getElementById('productAanbevelingDiv').style.display = 'block'; } renderVergelijkingChart(jaarlijksVerbruikKwh, jaarlijkseOpbrengstKwh); if (totaalWp > 0) { document.getElementById('energieProfielDiv').style.display = 'block'; renderDailyEnergyChart(totaalDagelijksVerbruik, dagelijkseOpbrengstKwh, batterijCapaciteit); } else { document.getElementById('energieProfielDiv').style.display = 'none'; } }
        function renderVergelijkingChart(jaarlijksVerbruik, jaarlijkseOpbrengst) { const ctx = document.getElementById('vergelijkingChartCanvas').getContext('2d'); const stroomprijs = 0.30; const terugleververgoeding = 0.05; const zelfverbruikPercentage = 0.35; const kostenZonderPanelen = jaarlijksVerbruik * stroomprijs; const directEigenVerbruik = Math.min(jaarlijksVerbruik, jaarlijkseOpbrengst * zelfverbruikPercentage); const nogTeKopenStroom = jaarlijksVerbruik - directEigenVerbruik; const teruggeleverdeStroom = jaarlijkseOpbrengst - directEigenVerbruik; const kostenMetPanelen = Math.max(0, (nogTeKopenStroom * stroomprijs) - (teruggeleverdeStroom * terugleververgoeding)); if (vergelijkingChart) vergelijkingChart.destroy(); vergelijkingChart = new Chart(ctx, { type: 'bar', data: { labels: ['Zonder Zonnepanelen', 'Met Zonnepanelen'], datasets: [{ label: 'Geschatte Jaarlijkse Energiekosten', data: [kostenZonderPanelen.toFixed(0), kostenMetPanelen.toFixed(0)], backgroundColor: ['rgba(231, 76, 60, 0.7)', 'rgba(46, 204, 113, 0.7)'], }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (c) => `â‚¬ ${c.raw}` } } }, scales: { y: { beginAtZero: true, ticks: { callback: (v) => `â‚¬ ${v}` } } } } }); document.getElementById('vergelijkingsGrafiekDiv').style.display = 'block'; }
        function renderDailyEnergyChart(dagelijksVerbruik, dagelijkseZonneOpbrengst, batterijCapaciteit) { const ctx = document.getElementById('dailyEnergyChartCanvas').getContext('2d'); const verbruikProfiel = [0.03,0.02,0.02,0.02,0.03,0.05,0.07,0.06,0.05,0.04,0.04,0.04,0.05,0.04,0.04,0.05,0.06,0.08,0.09,0.08,0.07,0.06,0.05,0.04]; const zonneProfiel = [0,0,0,0,0,0.01,0.03,0.06,0.09,0.11,0.13,0.14,0.13,0.12,0.09,0.05,0.03,0.01,0,0,0,0,0,0]; const geschaaldVerbruik = verbruikProfiel.map(p => p * dagelijksVerbruik); const geschaaldeOpbrengst = zonneProfiel.map(p => p * dagelijkseZonneOpbrengst); let batterijLading = 0; const nettoVanGrid = []; for (let i = 0; i < 24; i++) { const verbruik = geschaaldVerbruik[i]; const opbrengst = geschaaldeOpbrengst[i]; const netto = opbrengst - verbruik; if (netto > 0) { const kanOpladen = batterijCapaciteit - batterijLading; const laadHoeveelheid = Math.min(netto, kanOpladen); batterijLading += laadHoeveelheid; nettoVanGrid.push(-(netto - laadHoeveelheid)); } else { const kanOntladen = batterijLading; const ontlaadHoeveelheid = Math.min(-netto, kanOntladen); batterijLading -= ontlaadHoeveelheid; nettoVanGrid.push(-(netto + ontlaadHoeveelheid)); } } if (dailyEnergyChart) { dailyEnergyChart.destroy(); } dailyEnergyChart = new Chart(ctx, { type: 'bar', data: { labels: Array.from({length: 24}, (_, i) => `${i}:00`), datasets: [{ type: 'line', label: 'Verbruik (kWh)', data: geschaaldVerbruik, borderColor: 'rgba(231, 76, 60, 1)', backgroundColor: 'rgba(231, 76, 60, 0.1)', fill: true, tension: 0.4 }, { type: 'line', label: 'Zonne-opbrengst (kWh)', data: geschaaldeOpbrengst, borderColor: 'rgba(46, 204, 113, 1)', backgroundColor: 'rgba(46, 204, 113, 0.1)', fill: true, tension: 0.4 }, { label: 'Netto van/naar Grid (kWh)', data: nettoVanGrid, backgroundColor: (c) => { return c.dataset.data[c.dataIndex] >= 0 ? 'rgba(243, 156, 18, 0.7)' : 'rgba(155, 89, 182, 0.7)'; } }] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { title: { display: true, text: 'Tijdstip (uur)' } }, y: { stacked: false, beginAtZero: true, title: { display: true, text: 'Energie (kWh)' } } }, plugins: { tooltip: { mode: 'index', intersect: false, callbacks: { label: (c) => `${c.dataset.label}: ${c.parsed.y.toFixed(2)} kWh` } }, legend: { position: 'top' }, title: { display: true, text: 'Oranje = Stroom van net, Paars = Stroom naar net' } }, interaction: { mode: 'index', intersect: false } } }); }
    </script>
</body>
</html>
