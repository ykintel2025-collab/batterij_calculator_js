<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thuisbatterij Calculator V3.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* CSS is uitgebreid voor de nieuwe resultatenpagina */
        body { font-family: 'Roboto', sans-serif; background-color: #f0f4f8; color: #333; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; box-sizing: border-box; }
        .container { max-width: 700px; width: 100%; background-color: #ffffff; padding: 40px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }
        .logo { max-width: 250px; width: 100%; height: auto; margin-bottom: 20px; }
        h1 { color: #1e3a5f; font-size: 2.5rem; margin-top: 0; }
        h2.question-title { font-size: 1.8rem; font-weight: 700; margin-bottom: 20px; color: #1e3a5f; }
        .step-container, #start-scherm { display: none; }
        .step-container.active, #start-scherm.active { display: block; }
        .answer-option { border: 2px solid #e0e6ed; border-radius: 12px; padding: 20px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; text-align: left; }
        .answer-option:hover { border-color: #3498db; background-color: #f9fcff; }
        .answer-option.selected { border-color: #2ecc71; background-color: #eaf9ed; box-shadow: 0 4px 12px rgba(46, 204, 113, 0.2); }
        .answer-option .icon { font-size: 2rem; color: #1e3a5f; margin-right: 15px; display: inline-block; width: 30px; text-align: center; }
        .input-text { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #e0e6ed; border-radius: 8px; box-sizing: border-box; font-size: 1rem; transition: border-color 0.3s; }
        .input-text:focus { outline: none; border-color: #3498db; }
        .button-container { display: flex; justify-content: space-between; margin-top: 30px; }
        .btn { padding: 15px 30px; border: none; border-radius: 50px; cursor: pointer; font-size: 1rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s ease; text-decoration: none; }
        .btn-primary { background-color: #3498db; color: white; }
        .btn-primary:hover { background-color: #2980b9; transform: translateY(-2px); }
        .btn-secondary { background-color: #e0e6ed; color: #555; }
        .btn-secondary:hover { background-color: #c9d0d8; transform: translateY(-2px); }
        .progress-bar-container { background-color: #e0e6ed; border-radius: 50px; height: 10px; margin-bottom: 10px; }
        .progress-bar { height: 100%; background-color: #2ecc71; border-radius: 50px; width: 0%; transition: width 0.4s ease; }
        .progress-text { text-align: center; font-size: 0.9rem; margin-bottom: 20px; color: #555; }
        .reassurance-text { font-style: italic; color: #555; margin-top: 20px; }
        
        /* --- NIEUWE CSS VOOR RESULTATENPAGINA --- */
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left; margin-top: 20px; }
        .result-card { background-color: #f9fbfd; padding: 20px; border-radius: 12px; border: 1px solid #e0e6ed; }
        .result-card h3 { margin-top: 0; color: #1e3a5f; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .result-card ul { padding-left: 20px; margin: 0; }
        .result-card li { margin-bottom: 8px; color: #555; }
        .result-card .value { font-weight: 700; color: #333; }
        .main-recommendation { grid-column: 1 / -1; text-align: center; background-color: #eaf9ed; border-color: #2ecc71; }
        .main-recommendation h2 { font-size: 1.8rem; color: #27ae60; margin-top: 0; }
        .main-recommendation p { font-size: 1.2rem; }
        .chart-card { grid-column: 1 / -1; height: 350px; }
    </style>
</head>
<body>
    <div id="start-scherm" class="container active">
        <img src="exclupower-logo.jpg" alt="Exclupower Bedrijfslogo" class="logo">
        <h1>Welkom bij de Thuisbatterij Calculator</h1>
        <p>Ontdek welke thuisbatterij het beste bij uw situatie past.</p>
        <a href="#" class="btn btn-primary" id="startBtn">Start de berekening</a>
    </div>

    <div id="calculator-scherm" class="container" style="display: none;">
        <div class="progress-bar-container"> <div class="progress-bar" id="progressBar"></div> </div>
        <div class="progress-text" id="progressText">0% Voltooid</div>
        <div id="step-1" class="step-container"> <h2 class="question-title">Wat is je geschatte jaarlijkse energieverbruik?</h2> <div class="answer-option" data-value="klein" onclick="selectAnswer(1, this)"><span class="icon">🏠</span>Tot 2.000 kWh</div> <div class="answer-option" data-value="gemiddeld" onclick="selectAnswer(1, this)"><span class="icon">👨‍👩‍👧</span>2.000 - 4.000 kWh</div> <div class="answer-option" data-value="groot" onclick="selectAnswer(1, this)"><span class="icon">👨‍👩‍👧‍👦</span>4.000 - 6.000 kWh</div> <div class="answer-option" data-value="zeer_groot" onclick="selectAnswer(1, this)"><span class="icon">🏘️</span>6.000 - 8.000 kWh</div> <div class="answer-option" data-value="mega" onclick="selectAnswer(1, this)"><span class="icon">🏰</span>8.000+ kWh</div> </div>
        <div id="step-2" class="step-container"> <h2 class="question-title">Heeft u al zonnepanelen?</h2> <div class="answer-option" data-value="ja" onclick="selectAnswer(2, this)"><span class="icon">☀️</span>Ja</div> <div class="answer-option" data-value="nee" onclick="selectAnswer(2, this)"><span class="icon">🚫</span>Nee</div> </div>
        <div id="step-3" class="step-container"> <h2 class="question-title">Heeft u interesse om zonnepanelen te laten installeren?</h2> <div class="answer-option" data-value="ja" onclick="selectAnswer(3, this)"><span class="icon">👍</span>Ja, ik heb interesse</div> <div class="answer-option" data-value="nee" onclick="selectAnswer(3, this)"><span class="icon">👎</span>Nee, op dit moment niet</div> <p class="reassurance-text">😉 Geen zorgen, met onze oplossingen lever je niks terug als je dat niet wilt.</p> </div>
        <div id="step-4" class="step-container"> <h2 class="question-title">Hoeveel zonnepanelen heeft u?</h2> <input type="number" id="panelenInput" class="input-text" placeholder="Voer het aantal zonnepanelen in" min="1"> <div class="answer-option" onclick="selectAnswer(4, this)" data-value="dummy"> <span class="icon">#️⃣</span>Klik op 'Volgende' als u het aantal heeft ingevuld. </div> </div>
        <div id="step-5" class="step-container"> <h2 class="question-title">Heeft u een elektrische auto?</h2> <div class="answer-option" data-value="ja" onclick="selectAnswer(5, this)"><span class="icon">🚗</span>Ja</div> <div class="answer-option" data-value="nee" onclick="selectAnswer(5, this)"><span class="icon">🚶</span>Nee</div> </div>
        <div id="step-6" class="step-container"> <h2 class="question-title">Heeft u een warmtepomp?</h2> <div class="answer-option" data-value="ja" onclick="selectAnswer(6, this)"><span class="icon">🔥</span>Ja</div> <div class="answer-option" data-value="nee" onclick="selectAnswer(6, this)"><span class="icon">❄️</span>Nee</div> </div>
        <div id="step-7" class="step-container"> <h2 class="question-title">Wil je een schaalbare batterij?</h2> <div class="answer-option" data-value="zeer-belangrijk" onclick="selectAnswer(7, this)"><span class="icon">📈</span>Zeer belangrijk</div> <div class="answer-option" data-value="belangrijk" onclick="selectAnswer(7, this)"><span class="icon">📊</span>Belangrijk</div> <div class="answer-option" data-value="niet-zo-belangrijk" onclick="selectAnswer(7, this)"><span class="icon">➖</span>Niet zo belangrijk</div> <div class="answer-option" data-value="helemaal-niet-belangrijk" onclick="selectAnswer(7, this)"><span class="icon">🚫</span>Helemaal niet belangrijk</div> </div>
        <div id="step-8" class="step-container"> <h2 class="question-title">Hoe belangrijk is smart home integratie?</h2> <div class="answer-option" data-value="zeer-belangrijk" onclick="selectAnswer(8, this)"><span class="icon">💡</span>Zeer belangrijk</div> <div class="answer-option" data-value="belangrijk" onclick="selectAnswer(8, this)"><span class="icon">📱</span>Belangrijk</div> <div class="answer-option" data-value="niet-zo-belangrijk" onclick="selectAnswer(8, this)"><span class="icon">🏠</span>Niet zo belangrijk</div> <div class="answer-option" data-value="helemaal-niet-belangrijk" onclick="selectAnswer(8, this)"><span class="icon">❌</span>Helemaal niet belangrijk</div> </div>
        <div id="step-9" class="step-container"> <h2 class="question-title">Interesse in dynamische energieprijzen?</h2> <div class="answer-option" data-value="zeer-geinteresseerd" onclick="selectAnswer(9, this)"><span class="icon">💰</span>Ja, zeer geïnteresseerd</div> <div class="answer-option" data-value="enigszins-geinteresseerd" onclick="selectAnswer(9, this)"><span class="icon">📈</span>Ja, enigszins</div> <div class="answer-option" data-value="niet-geinteresseerd" onclick="selectAnswer(9, this)"><span class="icon">💸</span>Nee, niet geïnteresseerd</div> </div>
        
        <div id="resultaat-stap" class="step-container">
            <h2 class="question-title">Uw Persoonlijke Advies Dashboard</h2>
            <div class="results-grid">
                <div class="result-card main-recommendation">
                    <h2>Uw Aanbevolen Batterijcapaciteit</h2>
                    <p><strong id="capaciteitResultaat" style="font-size: 1.5em;"></strong></p>
                    <div id="productAanbevelingDiv" style="display:none;">
                        <p>Wij adviseren de <strong id="productNaam"></strong>.</p>
                        <a href="#" id="productLink" class="btn btn-primary" target="_blank">Bekijk Product</a>
                    </div>
                </div>

                <div class="result-card">
                    <h3>Uw Situatie</h3>
                    <ul>
                        <li>Jaarlijks verbruik: <span class="value" id="resJaarlijksVerbruik"></span> kWh</li>
                        <li>Grootverbruikers: <span class="value" id="resGrootverbruikers"></span></li>
                        <li>Zonne-installatie: <span class="value" id="resZonnepanelenStatus"></span></li>
                    </ul>
                </div>

                <div class="result-card">
                    <h3>Onze Aannames</h3>
                    <ul id="aannamesLijst">
                        </ul>
                </div>
                
                <div class="chart-card" id="vergelijkingsGrafiekDiv">
                    <h3>Besparingspotentieel met Zonnepanelen</h3>
                    <canvas id="vergelijkingChartCanvas"></canvas>
                </div>

                <div class="chart-card" id="energieProfielDiv">
                    <h3>Gesimuleerd Energieprofiel (24 uur)</h3>
                    <canvas id="dailyEnergyChartCanvas"></canvas>
                </div>
            </div>
        </div>
        
        <div class="button-container">
            <button class="btn btn-secondary" id="terugBtn" onclick="prevStep()">← Terug</button>
            <button class="btn btn-primary" id="volgendeBtn" onclick="nextStep()">Volgende →</button>
        </div>
    </div>

    <script>
        // JS is grotendeels hetzelfde, met een vernieuwde berekenAdvies functie
        let currentStep = 1;
        const totalSteps = 9;
        const formAnswers = {};
        const verbruikJaarlijks = { "klein": 2000, "gemiddeld": 3000, "groot": 5000, "zeer_groot": 7000, "mega": 9000 };
        const products = [ { naam: "Basis Batterij 5 kWh", capaciteit: 5, link: "#" }, { naam: "Standaard Batterij 8 kWh", capaciteit: 8, link: "#" }, { naam: "Standaard Batterij 10 kWh", capaciteit: 10, link: "#" }, { naam: "Premium Batterij 15 kWh", capaciteit: 15, link: "#" }, { naam: "Grootverbruiker Batterij 20 kWh", capaciteit: 20, link: "#" } ];
        let dailyEnergyChart, vergelijkingChart;

        // Functies t/m selectAnswer zijn ongewijzigd...
        document.getElementById('startBtn').addEventListener('click', (e) => { e.preventDefault(); document.getElementById('start-scherm').style.display = 'none'; document.getElementById('calculator-scherm').style.display = 'block'; showStep(1); });
        function showStep(step) { document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active')); const el = document.getElementById(`step-${step}`) || document.getElementById('resultaat-stap'); if(el) el.classList.add('active'); updateButtons(); updateProgressBar(); }
        function updateButtons() { const t = document.getElementById('terugBtn'), v = document.getElementById('volgendeBtn'); t.style.display = (currentStep>1&&currentStep<=totalSteps+1)?'block':'none'; v.style.display = (currentStep<=totalSteps)?'block':'none'; let l = false; let ts = currentStep; while(ts<totalSteps){ ts++; if(!isStepSkipped(ts)){l=false;break;} l=true;} v.textContent = (currentStep>=totalSteps||l)?'Bereken advies':'Volgende →'; }
        function updateProgressBar() { const p = ((currentStep - 1) / totalSteps) * 100; document.getElementById('progressBar').style.width = `${p}%`; document.getElementById('progressText').textContent = `${Math.round(p)}% Voltooid`; }
        function isStepSkipped(step) { if (step === 3 && formAnswers['step-2'] === 'ja') return true; if (step === 4 && formAnswers['step-2'] === 'nee') return true; return false; }
        function nextStep() { const cs = document.getElementById(`step-${currentStep}`); const so = cs.querySelector('.selected'); if (currentStep===4){ const pi = document.getElementById('panelenInput'); if(!pi.value||parseInt(pi.value)<=0){alert("Vul een geldig aantal zonnepanelen in.");return;} formAnswers[`step-${currentStep}`]=parseInt(pi.value); cs.querySelector('.answer-option').classList.add('selected');} else { if(!so){alert("Selecteer een optie.");return;} formAnswers[`step-${currentStep}`]=so.dataset.value;} let l=false; let ts=currentStep; while(ts<totalSteps){ts++; if(!isStepSkipped(ts)){l=false;break;}l=true;} if(currentStep>=totalSteps||l){berekenAdvies();return;} do{currentStep++;}while(isStepSkipped(currentStep)); showStep(currentStep); }
        function prevStep() { delete formAnswers[`step-${currentStep}`]; do { currentStep--; } while (isStepSkipped(currentStep)); if (currentStep >= 1) showStep(currentStep); }
        function selectAnswer(step, element) { const c = document.getElementById(`step-${step}`); c.querySelectorAll('.answer-option').forEach(el => el.classList.remove('selected')); element.classList.add('selected'); }
        function findBestProduct(c) { let bp = null, md = Infinity; for(const p of products){ if(p.capaciteit>=c){const d=p.capaciteit-c; if(d<md){md=d;bp=p;}}} if(!bp) bp=products[products.length-1]; return bp; }

        // --- VERNIEUWDE BEREKENADVIES FUNCTIE ---
        function berekenAdvies() {
            currentStep = totalSteps + 1;

            // 1. Verzamel basisgegevens
            const jaarlijksVerbruikKwh = verbruikJaarlijks[formAnswers['step-1']];
            const heeftEV = formAnswers['step-5'] === "ja";
            const heeftWarmtepomp = formAnswers['step-6'] === "ja";
            const totaalDagelijksVerbruik = (jaarlijksVerbruikKwh / 365) + (heeftEV ? 10 : 0) + (heeftWarmtepomp ? 8 : 0);

            // 2. Bereken zonne-energie opbrengst o.b.v. Wp
            let totaalWp = 0;
            let jaarlijkseOpbrengstKwh = 0;
            let aannamesHTML = `<li>Conversiefactor: <span class="value">0,9 kWh / Wp</span></li>`;

            if (formAnswers['step-2'] === 'ja') { // Heeft al panelen
                const aantalPanelen = formAnswers['step-4'];
                totaalWp = aantalPanelen * 400;
                aannamesHTML += `<li>Uw panelen: <span class="value">${aantalPanelen} x 400 Wp</span></li>`;
                document.getElementById('resZonnepanelenStatus').textContent = `${totaalWp} Wp (bestaand)`;
            } else if (formAnswers['step-3'] === 'ja') { // Wil panelen
                totaalWp = 12 * 430;
                aannamesHTML += `<li>Advies panelen: <span class="value">12 x 430 Wp</span></li>`;
                document.getElementById('resZonnepanelenStatus').textContent = `${totaalWp} Wp (advies)`;
            } else { // Geen panelen en geen interesse
                document.getElementById('resZonnepanelenStatus').textContent = 'Geen';
            }
            
            jaarlijkseOpbrengstKwh = totaalWp * 0.9;
            const dagelijkseOpbrengstKwh = jaarlijkseOpbrengstKwh / 365;

            // 3. Bereken batterijcapaciteit
            let batterijCapaciteit = 0;
            if (dagelijkseOpbrengstKwh > (jaarlijksVerbruikKwh / 365)) {
                batterijCapaciteit = (dagelijkseOpbrengstKwh - (jaarlijksVerbruikKwh / 365)) * 0.75;
            } else {
                batterijCapaciteit = 5; // Standaard voor arbitrage/peak-shaving
            }
            batterijCapaciteit = Math.max(5, Math.round(batterijCapaciteit));

            // 4. Vul het dashboard
            document.getElementById('capaciteitResultaat').textContent = `${batterijCapaciteit} kWh`;
            document.getElementById('resJaarlijksVerbruik').textContent = jaarlijksVerbruikKwh;
            document.getElementById('resGrootverbruikers').textContent = `${heeftEV ? 'Elektrische Auto' : ''} ${heeftWarmtepomp ? 'Warmtepomp' : ''}` || 'Geen';
            document.getElementById('aannamesLijst').innerHTML = aannamesHTML;

            const aanbevolenProduct = findBestProduct(batterijCapaciteit);
            if (aanbevolenProduct) {
                document.getElementById('productNaam').textContent = aanbevolenProduct.naam;
                document.getElementById('productLink').href = aanbevolenProduct.link;
                document.getElementById('productAanbevelingDiv').style.display = 'block';
            }

            // 5. Render de grafieken
            renderVergelijkingChart(jaarlijksVerbruikKwh, jaarlijkseOpbrengstKwh);
            if (totaalWp > 0) {
                document.getElementById('energieProfielDiv').style.display = 'block';
                renderDailyEnergyChart(totaalDagelijksVerbruik, dagelijkseOpbrengstKwh, batterijCapaciteit);
            } else {
                document.getElementById('energieProfielDiv').style.display = 'none';
            }
            
            showStep('resultaat-stap');
            updateProgressBar();
        }
        
        // --- NIEUWE FUNCTIE VOOR VERGELIJKINGSGRAFIEK ---
        function renderVergelijkingChart(jaarlijksVerbruik, jaarlijkseOpbrengst) {
            const ctx = document.getElementById('vergelijkingChartCanvas').getContext('2d');
            const stroomprijs = 0.30; // €/kWh
            const terugleververgoeding = 0.05; // €/kWh
            const zelfverbruikPercentage = 0.35; // 35%

            // Scenario 1: Geen zonnepanelen
            const kostenZonderPanelen = jaarlijksVerbruik * stroomprijs;
            
            // Scenario 2: Met zonnepanelen
            const directEigenVerbruik = Math.min(jaarlijksVerbruik, jaarlijkseOpbrengst * zelfverbruikPercentage);
            const nogTeKopenStroom = jaarlijksVerbruik - directEigenVerbruik;
            const teruggeleverdeStroom = jaarlijkseOpbrengst - directEigenVerbruik;
            const kostenMetPanelen = (nogTeKopenStroom * stroomprijs) - (teruggeleverdeStroom * terugleververgoeding);

            if (vergelijkingChart) vergelijkingChart.destroy();
            vergelijkingChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Zonder Zonnepanelen', 'Met Zonnepanelen (Advies)'],
                    datasets: [{
                        label: 'Geschatte Jaarlijkse Energiekosten',
                        data: [kostenZonderPanelen.toFixed(0), kostenMetPanelen.toFixed(0)],
                        backgroundColor: ['rgba(231, 76, 60, 0.7)', 'rgba(46, 204, 113, 0.7)'],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: (c) => `€ ${c.raw}` } }
                    },
                    scales: { y: { beginAtZero: true, ticks: { callback: (v) => `€ ${v}` } } }
                }
            });
            // Verberg grafiek als er geen opbrengst is
            document.getElementById('vergelijkingsGrafiekDiv').style.display = jaarlijkseOpbrengst > 0 ? 'block' : 'none';
        }

        function renderDailyEnergyChart(dagelijksVerbruik, dagelijkseZonneOpbrengst, batterijCapaciteit) {
            // Deze functie is ongewijzigd
            const ctx = document.getElementById('dailyEnergyChartCanvas').getContext('2d'); const verbruikProfiel = [0.03,0.02,0.02,0.02,0.03,0.05,0.07,0.06,0.05,0.04,0.04,0.04,0.05,0.04,0.04,0.05,0.06,0.08,0.09,0.08,0.07,0.06,0.05,0.04]; const zonneProfiel = [0,0,0,0,0,0.01,0.03,0.06,0.09,0.11,0.13,0.14,0.13,0.12,0.09,0.05,0.03,0.01,0,0,0,0,0,0]; const geschaaldVerbruik = verbruikProfiel.map(p => p * dagelijksVerbruik); const geschaaldeOpbrengst = zonneProfiel.map(p => p * dagelijkseZonneOpbrengst); let batterijLading = 0; const nettoVanGrid = []; for (let i = 0; i < 24; i++) { const verbruik = geschaaldVerbruik[i]; const opbrengst = geschaaldeOpbrengst[i]; const netto = opbrengst - verbruik; if (netto > 0) { const kanOpladen = batterijCapaciteit - batterijLading; const laadHoeveelheid = Math.min(netto, kanOpladen); batterijLading += laadHoeveelheid; nettoVanGrid.push(-(netto - laadHoeveelheid)); } else { const kanOntladen = batterijLading; const ontlaadHoeveelheid = Math.min(-netto, kanOntladen); batterijLading -= ontlaadHoeveelheid; nettoVanGrid.push(-(netto + ontlaadHoeveelheid)); } } if (dailyEnergyChart) { dailyEnergyChart.destroy(); } dailyEnergyChart = new Chart(ctx, { type: 'bar', data: { labels: Array.from({length: 24}, (_, i) => `${i}:00`), datasets: [{ type: 'line', label: 'Verbruik (kWh)', data: geschaaldVerbruik, borderColor: 'rgba(231, 76, 60, 1)', backgroundColor: 'rgba(231, 76, 60, 0.1)', fill: true, tension: 0.4 }, { type: 'line', label: 'Zonne-opbrengst (kWh)', data: geschaaldeOpbrengst, borderColor: 'rgba(46, 204, 113, 1)', backgroundColor: 'rgba(46, 204, 113, 0.1)', fill: true, tension: 0.4 }, { label: 'Netto van/naar Grid (kWh)', data: nettoVanGrid, backgroundColor: (c) => { return c.dataset.data[c.dataIndex] >= 0 ? 'rgba(243, 156, 18, 0.7)' : 'rgba(155, 89, 182, 0.7)'; } }] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { title: { display: true, text: 'Tijdstip (uur)' } }, y: { stacked: false, beginAtZero: true, title: { display: true, text: 'Energie (kWh)' } } }, plugins: { tooltip: { mode: 'index', intersect: false, callbacks: { label: (c) => `${c.dataset.label}: ${c.parsed.y.toFixed(2)} kWh` } }, legend: { position: 'top' }, title: { display: true, text: 'Oranje = Stroom van net, Paars = Stroom naar net' } }, interaction: { mode: 'index', intersect: false } } });
        }
    </script>
</body>
</html>
